# ===============================
# Author: jessun.zhang@outlook.com
# Useage: fish shell config file
# Location: ~/.config/fish/config.fish
# ===============================



# ====================== Var Definition ====================== {
export LOCAL_SOCKS5_PROXY='socks5://127.0.0.1:1080'
export LOCAL_HTTP_PROXY='http://127.0.0.1:1087'

{% if yadm.class=="actiontech-dev" %}
set -g __fish_prompt_hostname "10.186.16.118"
{% endif %}


{% if yadm.class=="mba" %}
set -g __fish_prompt_hostname "mba"
{% endif %}

{% if yadm.class=="mbp" %}
set -g __fish_prompt_hostname "mbp"
{% endif %}

# ====================== Var Definition ====================== }



# ====================== Gnome Keyring  ====================== {
# https://wiki.archlinux.org/title/GNOME_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)/Keyring_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E8%87%AA%E5%8A%A8%E7%99%BB%E9%99%86
if test -n "$DESKTOP_SESSION"
    set (gnome-keyring-daemon --start | string split "=")
end
# ====================== Gnome Keyring  ====================== }



# ====================== Commands alias ====================== {
switch (uname)
    case 'Darwin'
        # if type -q 'nvm' 
        #     # nvm use default
        # end
    case 'Linux'
        if type -q 'xsel'
            alias pbcopy 'xsel --clipboard --input'
            alias pbpaste 'xsel --clipboard --output'
        end
    case "*"
        echo "unknowon os"
end

alias switch_capslock_esc 'setxkbmap -option caps:swapescape'
alias clean_tmux_cache='rm -rf /home/jessun/.tmux/resurrect/* && tmux kill-server'
if type -q "setxkbmap"
    setxkbmap -option caps:swapescape
end
# ====================== Commands alias ====================== }



# ======================== Git alias ======================== {
if type -q 'git'
    alias copycurrentgitbranchname 'echo (git rev-parse --abbrev-ref HEAD) | pbcopy'
    alias gitcleanproxy "git config --global http.proxy ''; git config --global https.proxy ''"
    alias gitcommitdebug 'git add . && git commit -m "DEBUG" && git push'
    alias alldeletebranchesgit 'git branch | grep -v "master" | xargs git branch -D'
    alias mergedbarncheletedgit 'git branch --merged | egrep -v "(^\*|master)" | xargs git branch -d'
    alias pushcurrentgit 'git push -u origin (git rev-parse --abbrev-ref HEAD)'
    # alias forcepushcurrentgit 'git push -u -f origin (git rev-parse --abbrev-ref HEAD)'
    alias abortcherry 'git cherry-pick --abort'
    alias pick 'git cherry-pick'
    alias abortrebase 'git rebase --abort'
    alias gitusehttpproxy "git config --global http.proxy '$LOCAL_HTTP_PROXY'; git config --global https.proxy '$LOCAL_HTTP_PROXY'"
    alias gitusesocks5proxy "git config --global http.proxy '$LOCAL_SOCKS5_PROXY'; git config --global https.proxy '$LOCAL_SOCKS5_PROXY'"
    alias rebasecontinuegit "git rebase --continue"
    alias masterrebasegit "git rebase -i origin/master"
    alias mainrebasegit "git rebase -i origin/main"
    alias fetchgitall "git fetch --all"
    alias pullgitall "git pull --all"
end
# ======================== Git alias ======================== }



# ========================== Golang ========================== {
if type -q 'go'
    alias golangcirundocker "docker run --rm -v (pwd):/app -w /app golangci/golangci-lint:v1.43.0 golangci-lint run"
    alias golangcirun "golangci-lint run"
{% if yadm.class=="mba" %}
    alias govet "go vet ./..."
{% else %}
    alias govet "CGO_CFLAGS=\"-g -O2 -Wno-return-local-addr\" go vet ./..."
{% endif %}
    alias gomod "http_porxy="" https_proxy="" all_proxy="" go mod vendor;and go mod tidy -go=1.16 ;and go mod tidy -go=1.17"
    alias gotagsgenerate "gotags -R ./ > .tags"

    # Golang environment
    export GO111MODULE=on
    export GOPROXY=goproxy.cn,goproxy.io,direct 
    export GOPRIVATE=actiontech.cloud,github.com/actiontech/sqle-ee
    export GOINSECURE=actiontech.cloud

    # Gvm
    if test -e "$HOME/.gvm/environments/default"
        bass source "$HOME/.gvm/environments/default"
    end
end
# ========================== Golang ========================== {



# ======================== Proxy alias ======================= {
alias cleanallproxy "export all_proxy=; export http_proxy=; export https_proxy=; git config --global http.proxy ''; git config --global https.proxy ''"
alias shellusehttpproxy "export all_proxy='$LOCAL_HTTP_PROXY'; export http_proxy='$LOCAL_HTTP_PROXY'; export https_proxy='$LOCAL_HTTP_PROXY'"
alias shellusesocks5proxy "export all_proxy='$LOCAL_SOCKS5_PROXY'; export http_proxy='$LOCAL_SOCKS5_PROXY'; export https_proxy='$LOCAL_SOCKS5_PROXY'"
alias usehttpproxy "export all_proxy='$LOCAL_HTTP_PROXY'; export http_proxy='$LOCAL_HTTP_PROXY'; export https_proxy='$LOCAL_HTTP_PROXY'; git config --global http.proxy '$LOCAL_HTTP_PROXY'; git config --global https.proxy '$LOCAL_HTTP_PROXY'"
alias usesocks5proxy "export all_proxy='$LOCAL_SOCKS5_PROXY'; export http_proxy='$LOCAL_SOCKS5_PROXY'; export https_proxy='$LOCAL_SOCKS5_PROXY'; git config --global http.proxy '$LOCAL_SOCKS5_PROXY'; git config --global https.proxy '$LOCAL_SOCKS5_PROXY'"
# ======================== Proxy alias ======================= }



# =================== Environment variables =================== {
export TERM="screen-256color"
export LANG=zh_CN.UTF-8
set -Ux GPG_TTY (tty)

# local bin
if test -d "$HOME/.local/bin/"
    set -gx PATH "$HOME/.local/bin/" $PATH
end

# rust
if test -d "$HOME/.cargo/bin/"
    set -gx PATH "$HOME/.cargo/bin/" $PATH
end
if type -q rustc
    export RUST_SRC_PATH=(rustc --print sysroot)/lib/rustlib/src/rust/library/
end

# ruby
if test -d "$HOME/.rbenv/bin"
    set -g PATH "$HOME/.rbenv/bin" $PATH
end
if test -d "$HOME/.rbenv/shims"
    set -g PATH "$HOME/.rbenv/shims" $PATH
end
if test -d "$HOME/.local/share/gem/ruby/3.0.0/bin"
    set -g PATH "$HOME/.local/share/gem/ruby/3.0.0/bin" $PATH
end
if type -q 'rbenv'
    status --is-interactive; and rbenv init - fish | source
end

# node
set --universal nvm_default_version lts
if test -d "$HOME/.yarn/bin/"
    set -gx PATH "$HOME/.yarn/bin/" $PATH 
end
# =================== Environment variables =================== }



# =========================== python =========================== {
if test -e "$HOME/.pyenv/bin/pyenv"
    set -Ux PYENV_ROOT $HOME/.pyenv
    set -U fish_user_paths $PYENV_ROOT/bin $fish_user_paths
    pyenv init - | source
end
# =========================== python =========================== }



# ===================== actiontech.cloud  ===================== {
alias sshtodev="ssh jessun-dev@10.186.16.118"
# ===================== actiontech.cloud  ===================== }



# ===================== Derecated configs ===================== {
# alias sshtomac="sshuttle --dns -NHr jessun@192.168.124.2 127.0.0.1/0 -v"
# =================== Environment variables =================== }
